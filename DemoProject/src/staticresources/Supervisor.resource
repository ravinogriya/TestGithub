(function(){function M(){this.getPublicInterface=function(){var b;this.lockedPublicInterface||(b=this.createPublicInterface(),this.lockedPublicInterface=g.finalizeObject(b));return this.lockedPublicInterface?this.lockedPublicInterface:b}}function M(){this.getPublicInterface=function(){var b;this.lockedPublicInterface||(b=this.createPublicInterface(),this.lockedPublicInterface=g.finalizeObject(b));return this.lockedPublicInterface?this.lockedPublicInterface:b}}function l(b,a){window.liveagent.supervisor.dispatchEvent(b,
a)}function A(b){var a=[];g.forEachMapped(b,function(b){a.push(b.getPublicInterface())});return a}function N(b){function a(a){d=0==a?null:new Date((new Date).getTime()-a)}var d,c=b.queueLength;this.createPublicInterface=function(){return{getButtonId:function(){return b.buttonId},getLength:function(){return c},getOldestRequestTime:function(){return 0==c?null:d}}};this.update=function(b){c=b.queueSize;a(b.queueWaitTime)};a(b.queueWaitTime)}function O(b){var a={},d=0,c={},e=0,y=b.status?"Available"==
b.status:!0,P=b.lastChatTime;b.existingChats&&b.existingChats.forEach(function(b){if(!a[b.chatId]){d++;var c=new m(b);a[b.chatId]=c}});this.addAssigned=function(a){if(!c[a])return e++,c[a]=a};if(b.assignedChats){var h=this;b.assignedChats.forEach(function(a){h.addAssigned(a.chatId)})}var l=b.sessionDuration?(new Date).getTime()-b.sessionDuration:(new Date).getTime();this.createPublicInterface=function(){return{getId:function(){return b.agentId},getUserId:function(){return b.userId},getName:function(){return b.name},
getSessionStart:function(){return l},getCapacity:function(){return b.capacity},isAvailable:function(){return y},getChatCount:function(){return d},getAssignedChatCount:function(){return e},getSkillIds:function(){return b.skillIds.slice()},getChat:function(b){return a.hasOwnProperty(b)?a[b].getPublicInterface():null},getChats:function(){var b=[];g.forEachMapped(a,function(a){b.push(a.getPublicInterface())});return b},getLatestChatTime:function(){return P},logout:function(){return s.logoutAgent(b.agentId)},
setAway:function(){if(y)return s.setAgentStatus(b.agentId,!1);throw Error("Agent is already away");},setAvailable:function(){if(y)throw Error("Agent is already available");return s.setAgentStatus(b.agentId,!0)}}};this.hasChat=function(b){return a.hasOwnProperty(b)};this.addChat=function(b){if(!a[b.chatId]){d++;var c=new m(b);a[b.chatId]=c;P=(new Date).getTime();return c}};this.removeChat=function(b){if(a.hasOwnProperty(b)){d--;var c=a[b];delete a[b];return c}};this.updateStatus=function(a){y="Available"==
a};this.removeAssigned=function(a){if(c.hasOwnProperty(a))return e--,delete c[a],a};this.resetAssignedChats=function(){c={};e=0};this.getExistingChat=function(b){return a.hasOwnProperty(b)?a[b]:null}}function m(b){var a=b.sessionDuration?(new Date).getTime()-b.sessionDuration:(new Date).getTime(),d=!1,c=[],e={agentSneakPeek:"",chasitorSneakPeek:""},g={agentSneakPeek:!1,chasitorSneakPeek:!1};this.getSessionStart=function(){return a};this.transcriptReceived=function(){return d};this.storeMessage=function(a,
b){c.push({type:a,message:b})};this.getStoredMessages=function(){d=!0;return c};this.resetStoreMessages=function(){d=!1;c=[]};this.updateSneakPeekText=function(a,b,c){0===b?(g[a]=!0,e[a]=c):e[a]=0==e[a].length?Array(1+b).join(" ")+c:e[a].substr(0,b)+c};this.resetSneakPeek=function(a){e[a]="";g[a]=!1};this.getSneakPeekText=function(a){return e[a]};this.isSneakPeekTextComplete=function(a){return g[a]};this.createPublicInterface=function(){return{getChatId:function(){return b.chatId},getIpAddress:function(){return b.chasitorDetails.ipAddress},
getName:function(){return b.chasitorDetails.name?b.chasitorDetails.name:null},getSessionStart:function(){return a},getLanguage:function(){return b.chasitorDetails.language?b.chasitorDetails.language:null},getBrowser:function(){return b.chasitorDetails.browser?b.chasitorDetails.browser:null},getGeoLocation:function(){return b.chasitorDetails.geoLocation?b.chasitorDetails.geoLocation:null}}}}var e={},g={log:function(b){window&&window.console&&window.console.log(b)},logGroupStart:function(b){window.console.group?
window.console.groupCollapsed("LIVE AGENT: "+b):g.log("LIVE AGENT: "+b)},logGroupEnd:function(){window.console&&window.console.group&&window.console.groupEnd()},error:function(b){window&&window.console&&window.console.error?b instanceof Error&&window.console.log?b.stack?(g.logGroupStart("Error: "+b),window.console.log("Stacktrace: "),window.console.log(b.stack),g.logGroupEnd()):window.console.error(b):window.console.error(b):g.log(b)},forEachMapped:function(b,a){for(var d in b)b.hasOwnProperty(d)&&
a.call(window,b[d],d)},finalizeObject:function(b){var a={};if(Object.defineProperty){for(var d in b)if(b.hasOwnProperty(d))try{Object.defineProperty(a,d,{value:b[d],writable:!1,enumerable:!0,configurable:!1})}catch(c){return!1}return a}return!1}};Array.prototype.forEach||(Array.prototype.forEach=function(b,a){var d,c;if(null==this)throw new TypeError(" this is null or not defined");var e=Object(this),g=e.length>>>0;if("[object Function]"!={}.toString.call(b))throw new TypeError(b+" is not a function");
a&&(d=a);for(c=0;c<g;){var h;c in e&&(h=e[c],b.call(d,h,c,e));c++}});(function(){var b,a,d;function c(a,b){this.message=a;this.cause=b}function h(a,b,c){this.message="XHR Error from "+a+" ("+b+"): "+c;this.url=a;this.status=b;this.data=c}function l(){var a=[],b=[],c=null,d=null;return{complete:function(b){if(null!=c)return c&&window.setTimeout(function(){b.call(window,d)},1),this;a.push(b);return this},error:function(a){if(null!=c)return c||window.setTimeout(function(){a.call(window,d)},1),this;b.push(a);
return this},callback:function(e,f){c=e;d=f;(e?a:b).forEach(function(a){(a=a.call(window,f))&&(f=a)});return this}}}function k(a,b){var c=b?b:f.getAffinityToken();null==c&&(c="null");a.setAffinityToken(c)}function m(a,b,c,d,f,g){a=d?I(e.connection.getNounPrefix()+"/"+a):I(a);var h=l();a.onError=function(){h.callback(!1)};a.onSuccess=function(a){g&&(a=Sfdc.JSON.parse(a),h.callback(!0,a))};a.setVersion(t);a.setSessionKey(b);k(a,c);f?a.send(Sfdc.JSON.stringify(f),!0):a.send(null,!0);return h}b="Messages";
a="MultiNoun";d="ResyncSession";e.SystemMessage={ASYNC_RESULT:"AsyncResult",SWITCH_SERVER:"SwitchServer"};var r=null,s=null,t=32,I=null;c.prototype=Error();h.prototype=Error();(function(){function a(b){if(y&&b.source==y.contentWindow){var c=Sfdc.JSON.parse(b.data);if("init"==c.result)k=!0,r=c.url.substr(0,c.url.indexOf("/rest/cdm")),r.substr(0,r.indexOf("/",9)),g.log("CDM Initialized: "+r),m.forEach(function(a){a.resend()}),m=[];else if(b=P[c.id])switch(delete P[c.id],c.result){case "success":b.onSuccess.call(window,
c.data,c.status);break;case "error":g.log("CDM Error: "+c.url+" ("+c.status+")");c=new h(c.url,c.status,c.data);b.onError.call(window,c);break;default:throw Error("Unknown result: "+c.result);}}}function b(){l=!0;r.substr(0,r.indexOf("/",9));y=document.createElement("iframe");window.addEventListener?window.addEventListener("message",a,!1):window.attachEvent("onmessage",a,!1);var c=r+"/rest/cdm?version\x3d"+t+"\x26redirect\x3dtrue",d;a:{d=window.location.search.substring(1).split("\x26");for(var e=
0;e<d.length;e++){var f=d[e].split("\x3d");if("proxy"===f[0]&&1<f.length){d=f[1];break a}}d=""}Sfdc.isEmpty(d)||(d=Sfdc.String.escapeToHtml(d),c+="\x26proxy\x3d"+d);y.setAttribute("src",c);y.style.display="none";document.body.appendChild(y)}function c(){B=!0;window._liveAgentFlashReady=function(){u=document.getElementById("liveagentFlash");v=!0;J.forEach(function(a){a.resend()})};window._liveAgentFlashCallback=function(a){var b=document.createElement("div");b.style.display="none";b.id="liveagentFlash";
document.body.appendChild(b);a.embedSWF(s+"/g/XHRHelper.swf","liveagentFlash","0","0","9.0.124",s+"/expressInstall.swf",{callback:"_liveAgentFlashReady",version:t},{allowscriptaccess:"always"})};window._liveAgentFlashHandler=function(a,b,c){var d=c.substr(0,3);c=c.substr(3);"success"==a?w[b].onSuccess.call(w[b],c,d):w[b].onError.call(w[b],new h("Flash protocol error",d,c))};var a=document.createElement("script");a.type="text/javascript";a.src=s+"/g/flash.js";document.body.appendChild(a)}function d(){var a=
r.replace("http://","ws://"),a=a.replace("https://","wss://");q=new WebSocket(a+"/ws/rest");q.onmessage=function(a){var b=JSON.parse(a.data),c=C[b.id];if(!c)throw Error("Received response for unsent ID: "+b.id);200<=b.status&&300>b.status?c.onSuccess.call(c,b.data,b.status):c.onError.call(c,new h("WebSocket Error",b.status,a.data));delete C[b.id]};q.onopen=function(a){K=!0;g.log("Websocket Opened");x.forEach(function(a){a.resend()})};q.onerror=function(a){g.log("Websocket Error")};q.onclose=function(a){g.log("Websocket Close")};
p=!0}var e=null,f=function(){function a(b,c,d){b.headers.push({name:c,value:d})}this.headers=[{name:"Content-Type",value:"application/json"}];this.setSessionKey=function(b){a(this,"X-LIVEAGENT-SESSION-KEY",b)};this.setVersion=function(b){a(this,"X-LIVEAGENT-API-VERSION",b)};this.setSequence=function(b){a(this,"X-LIVEAGENT-SEQUENCE",b)};this.setAffinityToken=function(b){a(this,"X-LIVEAGENT-AFFINITY",b)}},l=!1,k=!1,y=null,m=[],P={},A=0,z=function(a){f.apply(this);var c=null,d="GET",e=r+"/rest/"+a,g=
"/rest/"+a,h=null;l||b();this.onError=function(){throw Error("Unhandled CDM error");};this.onSuccess=function(){};this.send=function(a,b){k?(c=A++,P[c]=this,y.contentWindow.postMessage(Sfdc.JSON.stringify({action:"send",id:c,headers:this.headers,method:d,url:r+g,data:a,async:b}),"*")):(h=a,m.push(this))};this.resend=function(){this.send(h)};this.abort=function(){k?(delete P[c],y.contentWindow.postMessage(Sfdc.JSON.stringify({action:"abort",id:c}),"*")):m=m.filter(function(a){return a==this?!1:!0})};
this.setMethod=function(a){d=a};this.getUrl=function(){return e}},B=!1,v=!1,J=[],u=null,D=0,w={},n=function(a){f.apply(this);var b=null,d="GET",e=r+"/rest/"+a;B||c();this.onError=function(){throw Error("Unhandled Flash error");};this.onSuccess=function(){};this.send=function(a){if(v){var c=D++;w[c]=this;e=-1==e.indexOf("?")?e+"?":e+"\x26";u.send(this.headers,e+"flash\x3d1\x26method\x3d"+(null==a?d:"POST"),a?a:null,"_liveAgentFlashHandler",c)}else b=a,J.push(this)};this.resend=function(){this.send(b)};
this.abort=function(){};this.setMethod=function(a){d=a};this.getUrl=function(){return e}},q,p=!1,K=!1,C={},E=0,x=[],L=function(a){var b="GET",c=null,e=null,f=null;p||d();this.onError=function(){throw Error("Unhandled WebSocket error");};this.onSuccess=function(){};this.setMethod=function(a){b=a};this.getUrl=function(){return a};this.resend=function(){this.send(c)};this.abort=function(){};this.send=function(d){if(K){var g=E++;C[g]=this;g=JSON.stringify({id:g,sequence:f,method:d?"POST":b,url:a,version:e});
null!=d&&(g+=d);q.send(g)}else c=d,x.push(this)};this.setSessionKey=function(){};this.setVersion=function(a){e=a};this.setSequence=function(a){f=a};this.setAffinityToken=function(){}};I=function(a){e||(0<=document.cookie.indexOf("__LIVE_AGENT_WEBSOCKETS_EXPERIMENTAL")&&void 0!=typeof window.WebSocket?(g.log("Using EXPERIMENTAL WebSockets mode for Live Agent connection. This is purely experimental and unsupported. Remove the cookie containing __LIVE_AGENT_WEBSOCKETS_EXPERIMENTAL and refresh to return to normal mode."),
e=L):window.postMessage?e=z:(g.log("User Agent does not support CDM. Falling back to Flash"),e=n));return new e(a)}})();var f={};(function(){function A(){if(null==u)throw Error("Not yet initialized");if(!(null!=n||0==q.length)){var b=[],c=null;p=q.slice(0);if(1==q.length)c=q.pop(),b.push(c),n=I(c.prefix+"/"+c.noun),c=c.data;else{for(;0<q.length;){var c=q.shift(),d={};d.prefix=c.prefix;d.noun=c.noun;d.object=c.data;b.push(d)}n=I(f.getSystemNounPrefix()+"/"+a);c={nouns:b}}x+=b.length;n.onError=function(a){clearTimeout(G);
G=null;var c=+a.status;if(403===c)g.log("Forbidden response: "+a),f.start();else if(409===c)N();else if(503===c){g.log("Affinity token changed");M();for(a=0;a<p.length;a++)U.push(p[a]);O()}else ba(c)?Q("Server responded with error: "+a,a,b):(g.log("Connection error ("+a.status+"): "+a),x-=p.length,q=p.concat(q),p=[],window.setTimeout(function(){n=null;A()},1E3))};n.onSuccess=function(a,b){clearTimeout(G);G=null;if(202==b)if(1<p.length){var c=Sfdc.JSON.parse(a).ack;c.sort();for(var d=x-p.length,e=
c.length-1;0<=e;e--){var f=c[e];C[f]?(E(p.splice(f-d-1,1)[0],C[f]),delete C[f]):K[f]=p.splice(f-d-1,1)[0]}}else C[x]?(E(p.pop(),C[x]),delete C[x]):K[x]=p.pop();for(e=0;e<p.length;e++)try{p[e].callback(!0)}catch(Y){g.log("Error encountered in callback: "),g.error(Y)}p=[];n=null;A();clearTimeout(S);S=null};n.setSessionKey(D);n.setVersion(t);n.setSequence(x.toString());var e=n;G=window.setTimeout(function(){e==n&&(clearTimeout(G),G=null,g.log("Sending timeout"),n.abort(),n.onError(new h(n.getUrl(),408)))},
ga);k(n);n.send(Sfdc.JSON.stringify(c),!0);null==S&&(S=window.setTimeout(function(){Q("Outgoing Connection retry timeout")},ha))}}function E(a,b){try{b.isSuccess?a.callback(!0):a.callback(!1,b.error)}catch(c){g.log("Exception when handling async response callback"),g.error(c)}}function M(){J=!0;V=v=reconnecting=!1;W();aa(!0);clearTimeout(R);clearTimeout(T);clearTimeout(S);w=null}function O(){m(f.getSystemNounPrefix()+"/"+d+"/"+u,D,w,!1,null,!0).complete(function(a){a&&a.isValid?(D=a.key,w=a.affinityToken,
f.restart(),f.onResyncState()):(Q("App server handover failed. Cancelling connection."),J=!1,w=null,V=!0)}).error(function(){Q("App server handover failed. Cancelling connection.");J=!1;w=null;V=!0})}function N(){Q("Out of sync. Cancelling connection.")}function Z(){if(null==u)throw Error("Not yet initialized");if(null==z){var a=!0===F?"\x26reconnect\x3dtrue":"";z=I(f.getSystemNounPrefix()+"/"+b+"?ack\x3d"+(L-1)+a+"\x26pc\x3d"+ia++);z.onError=function(a){if(v){var b=+a.status;403===b?(g.log("Forbidden response: "+
a),f.start()):503==b?(g.log("Affinity token changed"),M(),O()):409===b?N():ba(b)?Q("Polling error: "+a,a):null!=R&&!F&&(g.log("Unknown error, reconnecting: "+a),$(!0))}};z.onSuccess=function(a,b){if(v)try{if(F)try{f.onReconnect(!0)}catch(c){g.log("Exception in connection.onReconnect:"),g.error(c)}if(204!=b){var d=Sfdc.JSON.parse(a),Y=d.messages,h=d.sequence-(Y.length-1);Y.forEach(function(a){if(h<L)g.log("Discarding duplicate message "+h);else if(h>L)g.log("Sequence: "+h+", inboundSequence: "+L),
N();else if(L=h+=1,a.type==e.SystemMessage.SWITCH_SERVER)f.onSwitchServer(a.message.newUrl,r),r=a.message.newUrl;else if(a.type==e.SystemMessage.ASYNC_RESULT){var b=K[a.message.sequence];delete K[a.message.sequence];b?E(b,a.message):C[a.message.sequence]=a.message}else f.messageHandler.call(window,a.type,a.message)})}}finally{v&&$(!1)}};z.setSessionKey(D);z.setVersion(t);k(z);z.send(null,!0);R=window.setTimeout(function(){$(!0)},!0===F?ea:da);F||(T=window.setTimeout(function(){Q("Incoming Connection retry timeout")},
fa))}}function $(a){if(a){if(!F)f.onReconnect(!1)}else clearTimeout(T),T=null;F=a;clearTimeout(R);R=null;aa(F);Z()}function Q(a,b,d){"undefined"==typeof b&&(b=null);"undefined"==typeof d&&(d=[]);g.log(a);f.onError.call(window,new c("Connection Error",b));for(a=0;a<d.length;a++)d[a].callback(!1);X()}function X(){v&&(g.log("Cancelling connection"),v=F=!1,aa(!0),W(),clearTimeout(R),R=null,clearTimeout(T),T=null,clearTimeout(G),G=null,clearTimeout(S),S=null,null!=B&&(B.abort(),B=null))}function aa(a){null!=
z&&a&&z.abort();z=null}function W(){null!=n&&(n.abort(),p=[],q=[],K={},C={},n=null);L=x=0}function ba(a){for(var b=0;b<ca.length;++b)if(ca[b]===a)return!0;return!1}var z=null,B=null,v=!1,J=!1,u=null,D=null,w=null,n=null,q=[],p=[],K={},C={},ca=[400,404,405,500],x=0,L=0,da=4E4,ea=5E3,R=null,fa=12E4,T=null,F=!1,ga=1E4,G=null,ha=12E4,S=null,ia=0,V=!0,U=[];f.onError=function(a){};f.onInit=function(){};f.onReInit=function(){};f.onResyncState=function(){};f.onSwitchServer=function(a,b){};f.getSessionId=
function(){return u};f.getSessionKey=function(){return D};f.getAffinityToken=function(){return w};f.setSessionId=function(a){u=a};f.setSessionKey=function(a){D=a};f.enableOutboundMessage=function(){V=!0};f.send=function(a,b){return f.sendWithPrefix(f.getNounPrefix(),a,b)};f.sendWithPrefix=function(a,b,c){var d=l();if(null==u)return d.callback(!1),d;if(V){if(0<U.length){for(var e=0;e<U.length;e++)q.push(U[e]);U=[]}q.push({prefix:a,noun:b,data:c,callback:d.callback})}else U.push({prefix:a,noun:b,data:c,
callback:d.callback});A();return d};f.getNounPrefix=function(){return""};f.getSystemNounPrefix=function(){return"System"};f.messageHandler=function(a,b){};f.isRunning=function(){return v};f.stop=function(a){"undefined"==typeof a&&(a=!0);X();if(u){var b=I(f.getSystemNounPrefix()+"/SessionId/"+D);b.setMethod("DELETE");b.setVersion(t);k(b);b.send(null,a);u=null}};f.setSessionId=function(a){u=a};f.setSessionKey=function(a){D=a};f.restart=function(){v&&X();if(!r)throw Error("endpoint not set");if(!u)throw Error("session ID not set");
if(!D)throw Error("session Key not set");g.log("Restarting connection");v=!0;if(J)J=!1;else f.onInit();Z()};f.start=function(){v&&X();if(!r)throw Error("endpoint not set");v=!0;g.log("Starting connection");B=I(f.getSystemNounPrefix()+"/SessionId");B.onError=function(a){v=!1;f.onError.call(window,new c("Could not initialize connection",a))};B.onSuccess=function(a){a=Sfdc.JSON.parse(a);if("object"!=typeof a||"string"!=typeof a.id||0==a.id.length)g.log("Invalid session response"),f.onError.call(window,
new c("Invalid session id retrieved from server"));else{var b=null!=u;u=a.id;D=a.key;w=a.affinityToken;b?(g.log("ReInit connection"),f.onReInit()):(g.log("Init connection"),f.onInit());Z()}};B.setVersion(t);k(B);B.send(null,!0)};f.setEndpoint=function(a,b){r=r||a;s=b};f.onReconnect=function(a){};f.setAffinityToken=function(a){w=a}})();e.connection=f;e.doRequest=m;e.createCallbackHandler=l})();var W=!1,t={};N.prototype=new M;var k={},E={};O.prototype=new M;m.prototype=new M;m.get=function(b){for(var a in k)if(k.hasOwnProperty(a)){var d=
k[a].getExistingChat(b);if(d)return d}return null};var s={};(function(){e.SupervisorMessage={AGENT_CHAT_ASSIGNED_UPDATE:"AgentChatAssignedUpdate",AGENT_CHAT_ESTABLISHED:"AgentChatEstablished",AGENT_CHAT_MESSAGE:"AgentChatMessage",AGENT_CHAT_TRANSFERRED_TO_BUTTON:"AgentChatTransferredToButton",AGENT_JOINED_CONFERENCE:"AgentJoinedConference",AGENT_LEFT_CONFERENCE:"AgentLeftConference",AGENT_LOGIN:"AgentLogin",AGENT_LOGOUT:"AgentLogout",AGENT_NOT_TYPING:"AgentNotTyping",AGENT_SNEAK_PEEK_UPDATE:"AgentSneakPeekUpdate",
AGENT_STATUS_CHANGE:"AgentStatusChange",AGENT_TYPING:"AgentTyping",CHAT_ENDED:"ChatEnded",CLIENT_CHAT_MESSAGE:"ClientChatMessage",CLIENT_SNEAK_PEEK_UPDATE:"ClientSneakPeekUpdate",CLIENT_TYPING_UPDATE:"ClientTypingUpdate",FILE_TRANSFER:"FileTransfer",LOGIN_RESULT:"LoginResult",LOGOUT:"Logout",QUEUE_UPDATE:"QueueUpdate",SUPERVISOR_JOIN_RESULT:"SupervisorJoinResult",SUPERVISOR_SESSION_DATA:"SupervisorSessionData",WHISPER_MESSAGE:"WhisperMessage"};var b=e.connection;s={login:function(a,d,c){return b.send("SupervisorLogin",
{organizationId:a,sfdcSessionId:d,queueIds:c})},resyncState:function(a,b,c){a={organizationId:a,sfdcSessionId:b,queueIds:c};b=e.connection.getSessionId();c=e.connection.getSessionKey();var g=e.connection.getAffinityToken();return e.doRequest("SupervisorResyncState/"+b,c,g,!0,a,!1)},logoutAgent:function(a){return b.send("AgentLogout",{agentId:a})},setAgentStatus:function(a,d){return b.send("AgentStatus",{agentId:a,status:d?"Available":"Away"})},joinChat:function(a){m.get(a).resetStoreMessages();return b.send("SupervisorJoinChat",
{chatId:a})},leaveChat:function(a){return b.send("SupervisorLeaveChat",{chatId:a})},sendWhisperMessage:function(a,d){return b.send("WhisperMessage",{chatId:a,text:d})}}})();var h={LOGIN_SUCCESS:"supervisorLoginSuccess",LOGIN_FAILED:"supervisorLoginFailed",QUEUE_UPDATE:"queueUpdate",AGENT_LOGIN:"agentLogin",AGENT_LOGOUT:"agentLogout",AGENT_AVAILABLE:"agentAvailable",AGENT_AWAY:"agentAway",AGENT_CHAT_ASSIGNED_UPDATE:"agentChatAssignedUpdate",AGENT_CHAT_ESTABLISHED:"agentChatEstablished",AGENT_CHAT_ENDED:"agentChatEnded",
AGENT_CHAT_MESSAGE:"agentChatMessage",AGENT_NOT_TYPING:"agentNotTyping",AGENT_TYPING:"agentTyping",CONNECTION_ERROR:"supervisorConnectionError",RECONNECTING:"supervisorReconnecting",JOIN_CHAT_SUCCESS:"supervisorJoinChatSuccess",JOIN_CHAT_FAILED:"supervisorJoinChatFailed",CLIENT_CHAT_MESSAGE:"clientChatMessage",CLIENT_SNEAK_PEEK_UPDATE:"clinetSneakPeekUpdate",CLIENT_TYPING_UPDATE:"clientTypingUpdate",SUPERVISOR_WHISPER_MESSAGE:"supervisorWhisperMessage",AGENT_SNEAK_PEEK_UPDATE:"agentSneakPeekUpdate",
RESYNC_STATE_SUCCESS:"supervisorResyncStateSuccess",FILE_TRANSFER_EVENT:"fileTransferEvent",AGENT_CHAT_TRANSFERRED_TO_BUTTON:"agentChatTransferredToButton",AGENT_JOINED_CONFERENCE:"supervisorAgentJoinedConference",AGENT_LEFT_CONFERENCE:"supervisorAgentLeftConference"};e.connection.getNounPrefix=function(b){return"Supervisor"};e.connection.getChat=function(b){for(var a in k)if(k.hasOwnProperty(a)){var d=k[a].getPublicInterface().getChat(b);if(d)return d}return null};e.connection.messageHandler=function(b,
a){switch(b){case e.SupervisorMessage.LOGIN_RESULT:a.success?(a.queueLengths.forEach(function(a){var b=new N(a);t[a.buttonId]=b}),a.agents.forEach(function(a){var b=new O(a);k[a.agentId]=b;E[a.userId]=b}),l(h.LOGIN_SUCCESS,{supervisorName:a.supervisorName,queues:A(t),agents:A(k),hasChatMonitoring:a.hasChatMonitoring,hasWhisperMessage:a.hasWhisperMessage})):l(h.LOGIN_FAILED);break;case e.SupervisorMessage.SUPERVISOR_SESSION_DATA:a.success?(e.connection.enableOutboundMessage(),t={},k={},E={},a.queueLengths.forEach(function(a){var b=
new N(a);t[a.buttonId]=b}),a.agents.forEach(function(a){var b=new O(a);k[a.agentId]=b;E[a.userId]=b}),l(h.RECONNECTING,!0),l(h.RESYNC_STATE_SUCCESS,{queues:A(t),agents:A(k)}),g.log("Finished Resync Supervisor State")):l(h.LOGIN_FAILED);break;case e.SupervisorMessage.QUEUE_UPDATE:var d=t[a.buttonId];d&&(d.update(a),l(h.QUEUE_UPDATE,d.getPublicInterface()));break;case e.SupervisorMessage.AGENT_LOGIN:d=new O(a);k[a.agentId]=d;E[a.userId]=d;l(h.AGENT_LOGIN,d.getPublicInterface());break;case e.SupervisorMessage.AGENT_LOGOUT:if(d=
k[a.agentId]){var c=!1,H;for(H in k)if(k.hasOwnProperty(H)&&H!=a.agentId&&k[H].getPublicInterface().getUserId()==a.userId){c=!0;return}delete k[a.agentId];c||(delete E[a.userId],l(h.AGENT_LOGOUT,d.getPublicInterface()))}break;case e.SupervisorMessage.AGENT_STATUS_CHANGE:if(d=k[a.agentId])d.updateStatus(a.status),"Available"==a.status?l(h.AGENT_AVAILABLE,d.getPublicInterface()):(d.resetAssignedChats(),l(h.AGENT_AWAY,d.getPublicInterface()));break;case e.SupervisorMessage.AGENT_CHAT_ESTABLISHED:if(d=
k[a.agentId])(c=d.addChat(a))&&l(h.AGENT_CHAT_ESTABLISHED,{agent:d.getPublicInterface(),chat:c.getPublicInterface()});break;case e.SupervisorMessage.CHAT_ENDED:for(H in k)k.hasOwnProperty(H)&&k[H].hasChat(a.chatId)&&(d=k[H],(c=d.removeChat(a.chatId))&&l(h.AGENT_CHAT_ENDED,{agent:d.getPublicInterface(),chat:c.getPublicInterface(),type:a.type}));break;case e.SupervisorMessage.SUPERVISOR_JOIN_RESULT:if(a.success){if(c=m.get(a.chatId))d=c.getStoredMessages(),l(h.JOIN_CHAT_SUCCESS,{chat:c.getPublicInterface(),
transcript:a.transcript.concat(d)})}else l(h.JOIN_CHAT_FAILED);break;case e.SupervisorMessage.CLIENT_CHAT_MESSAGE:if(c=m.get(a.chatId))c.transcriptReceived()?(c.resetSneakPeek("chasitorSneakPeek"),l(h.CLIENT_CHAT_MESSAGE,{chat:c.getPublicInterface(),text:a.text})):c.storeMessage(e.SupervisorMessage.CLIENT_CHAT_MESSAGE,a);break;case e.SupervisorMessage.CLIENT_SNEAK_PEEK_UPDATE:if(c=m.get(a.chatId))c.updateSneakPeekText("chasitorSneakPeek",a.position,a.text),l(h.CLIENT_SNEAK_PEEK_UPDATE,{chat:c.getPublicInterface(),
sneakPeek:c.getSneakPeekText("chasitorSneakPeek"),sneakPeekComplete:c.isSneakPeekTextComplete("chasitorSneakPeek")});break;case e.SupervisorMessage.CLIENT_TYPING_UPDATE:(c=m.get(a.chatId))&&l(h.CLIENT_TYPING_UPDATE,{chat:c.getPublicInterface(),isTyping:a.isTyping});break;case e.SupervisorMessage.AGENT_CHAT_MESSAGE:(c=m.get(a.chatId))&&(c.transcriptReceived()?l(h.AGENT_CHAT_MESSAGE,{chat:c.getPublicInterface(),name:a.name,text:a.text}):c.storeMessage(e.SupervisorMessage.AGENT_CHAT_MESSAGE,a));break;
case e.SupervisorMessage.AGENT_NOT_TYPING:(c=m.get(a.chatId))&&l(h.AGENT_NOT_TYPING,{chat:c.getPublicInterface()});break;case e.SupervisorMessage.AGENT_TYPING:(c=m.get(a.chatId))&&l(h.AGENT_TYPING,{chat:c.getPublicInterface()});break;case e.SupervisorMessage.AGENT_CHAT_ASSIGNED_UPDATE:(d=k[a.agentId])&&(a.isAssigned?d.addAssigned(a.chatId):d.removeAssigned(a.chatId))&&l(h.AGENT_CHAT_ASSIGNED_UPDATE,{agent:d.getPublicInterface()});break;case e.SupervisorMessage.WHISPER_MESSAGE:(c=m.get(a.chatId))&&
(c.transcriptReceived()?l(h.SUPERVISOR_WHISPER_MESSAGE,{chat:c.getPublicInterface(),name:a.name,text:a.text}):c.storeMessage(e.SupervisorMessage.SUPERVISOR_WHISPER_MESSAGE,a));break;case e.SupervisorMessage.AGENT_SNEAK_PEEK_UPDATE:if(c=m.get(a.chatId))c.updateSneakPeekText("agentSneakPeek",a.position,a.text),l(h.AGENT_SNEAK_PEEK_UPDATE,{chat:c.getPublicInterface(),name:a.name,sneakPeek:c.getSneakPeekText("agentSneakPeek"),sneakPeekComplete:c.isSneakPeekTextComplete("agentSneakPeek")});break;case e.SupervisorMessage.FILE_TRANSFER:(c=
m.get(a.chatId))&&l(h.FILE_TRANSFER_EVENT,{chat:c.getPublicInterface(),type:a.type,attachmentId:a.attachmentId});break;case e.SupervisorMessage.AGENT_CHAT_TRANSFERRED_TO_BUTTON:d=k[a.agentId];(c=d.removeChat(a.chatId))&&d&&l(h.AGENT_CHAT_TRANSFERRED_TO_BUTTON,{agent:d.getPublicInterface(),chat:c.getPublicInterface(),buttonName:a.buttonName});break;case e.SupervisorMessage.AGENT_JOINED_CONFERENCE:(c=m.get(a.chatId))&&l(h.AGENT_JOINED_CONFERENCE,{name:a.name});break;case e.SupervisorMessage.AGENT_LEFT_CONFERENCE:d=
k[a.agentId],(c=d.removeChat(a.chatId))&&l(h.AGENT_LEFT_CONFERENCE,{agent:d.getPublicInterface(),chat:c.getPublicInterface(),name:a.name})}};window.liveagent||(window.liveagent={});window.liveagent.supervisor={Events:h,login:function(b,a,d,c,k){if(W)throw Error("You cannot login to an already initialized connection");W=!0;e.connection.setEndpoint(b,a);e.connection.onInit=function(){s.login(d,c,k)};e.connection.onReInit=function(){s.login(d,c,k)};e.connection.onError=function(a){l(h.CONNECTION_ERROR,
a)};e.connection.onReconnect=function(a){l(h.RECONNECTING,a)};e.connection.onResyncState=function(){l(h.RECONNECTING,!1);s.resyncState(d,c,k).error(function(){g.log("Supervisor ResyncState Error. Login again.");s.login(d,c,k)})};e.connection.start()},getQueue:function(b){return(b=t[b])?b.getPublicInterface():null},getQueues:function(){return A(t)},getAgent:function(b){return(b=k[b])?b.getPublicInterface():null},getAgentByUserId:function(b){return(b=E[b])?b.getPublicInterface():null},getAgents:function(){return A(k)},
getSessionId:function(){return e.connection.getSessionId()},isRunning:function(){return e.connection.isRunning()},joinChat:function(b){return s.joinChat(b)},leaveChat:function(b){return s.leaveChat(b)},sendWhisperMessage:function(b,a){return s.sendWhisperMessage(b,a)}};(function(b){var a={};b.addEventListener=function(b,c,e){"undefined"==typeof e&&(e="");a[b]||(a[b]=[]);a[b].push({listenerId:e,handler:c})};b.dispatchEvent=function(b,c){a[b]&&a[b].forEach(function(a){try{a.handler.call(window,c)}catch(b){g.error(b)}})};
b.removeEventListeners=function(b){if("undefined"==typeof b)a={};else for(var c in a)if(a.hasOwnProperty(c))for(var e=a[c].length;e--;)a[c][e].listenerId==b&&a[c].splice(e,1)}})(window.liveagent.supervisor)})();
